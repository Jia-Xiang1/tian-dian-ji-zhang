<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點記帳</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 700px;
  margin: auto;
  padding: 20px;
  background: #f9f9f9;
}

/* 統一區塊樣式 */
.form-card {
  background: #fff;
  border-radius: 12px;
  padding: 10px 12px;
  margin-bottom: 12px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.08), 0 4px 6px rgba(0,0,0,0.05);
  font-size: 1.4em;
}

/* 輸入欄不自動放大 */
input, select, button {
  font-size: 16px; /* iPhone 不放大 */
  padding: 6px;
  width: 100%;
  box-sizing: border-box;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-top: 6px;
}

/* 新增按鈕顏色 */
#addBtn {
  background: #007aff;
  color: #fff;
  border: none;
  cursor: pointer;
}

/* 表格 */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
th {
  background: #f0f0f0;
}

/* 統計區塊 */
#totals {
  margin-top: 12px;
  font-size: 1.2em;
}

/* 後台 */
#backendWrapper {
  display: none;
  margin-top: 12px;
}
#backendWrapper .product-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
}
#backendWrapper .product-row input {
  width: 25%;
  font-size: 1em;
}
</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<!-- 前台輸入 -->
<div class="form-card">
  日期<br>
  <input type="date" id="dateInput">
</div>

<div class="form-card">
  商品<br>
  <select id="productSelect"></select>
</div>

<div class="form-card">
  份數<br>
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="form-card">
  <button id="addBtn">新增</button>
</div>

<!-- 銷售表格 -->
<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 今日統計 -->
<div id="totals" class="form-card">
  <strong>今日總成本：</strong><span id="totalCost">0</span> 元<br>
  <strong>今日總收入：</strong><span id="totalRevenue">0</span> 元<br>
  <strong>今日總利潤：</strong><span id="totalProfit">0</span> 元<br>
</div>

<!-- 後台密碼 -->
<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<!-- 後台管理 -->
<div id="backendWrapper" class="form-card">
  <h3>後台設定成本 / 售價 / 新增商品</h3>
  <div id="backendProducts"></div>
  <div style="margin-top:8px;">
    新增商品名稱: <input type="text" id="newProductName" placeholder="商品名">
    售價: <input type="number" id="newProductPrice" placeholder="售價">
    成本: <input type="number" id="newProductCost" placeholder="成本">
    <button id="addProductBtn">新增商品</button>
  </div>
</div>

<script>
// 後台密碼
const correctPassword = "1234";
document.getElementById('unlockBtn').addEventListener('click', () => {
  if(document.getElementById('adminPassword').value === correctPassword){
    document.getElementById('backendWrapper').style.display="block";
    alert("後台已開啟");
    document.getElementById('adminPassword').value="";
  } else {
    alert("密碼錯誤");
  }
});

// 商品資料
let products = JSON.parse(localStorage.getItem('products')) || [
  {name:'雞蛋糕', price:50, cost:20},
  {name:'奶酪杯', price:60, cost:25},
  {name:'提拉米蘇杯', price:70, cost:30},
  {name:'雪媚娘', price:55, cost:25},
  {name:'紅糖糍粑', price:40, cost:15},
  {name:'奶茶凍', price:50, cost:20},
  {name:'桂花奶酪', price:60, cost:25},
  {name:'華夫餅', price:65, cost:30}
];

// 銷售紀錄
let salesRecords = JSON.parse(localStorage.getItem('salesRecords')) || [];

// 更新商品選單
function updateProductSelect(){
  const select = document.getElementById('productSelect');
  select.innerHTML="";
  products.forEach((p,i)=>{
    const opt = document.createElement('option');
    opt.value=i;
    opt.innerText=p.name;
    select.appendChild(opt);
  });
}
updateProductSelect();

// 前台新增銷售
document.getElementById('addBtn').addEventListener('click',()=>{
  const date = document.getElementById('dateInput').value;
  const productIndex = parseInt(document.getElementById('productSelect').value);
  const qty = parseInt(document.getElementById('qtyInput').value);
  if(!date || isNaN(qty) || qty<=0) return alert("請填完整資訊！");
  salesRecords.push({date, productIndex, qty});
  localStorage.setItem('salesRecords',JSON.stringify(salesRecords));
  document.getElementById('qtyInput').value=1;
  renderSales();
  updateTotals();
});

// 渲染表格
function renderSales(){
  const tbody = document.querySelector('#salesTable tbody');
  tbody.innerHTML="";
  salesRecords.forEach((r,idx)=>{
    const p = products[r.productIndex];
    const cost = p.cost;
    const price = p.price;
    const revenue = price*r.qty;
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${r.date}</td><td>${p.name}</td><td>${r.qty}</td>
                  <td>${cost}</td><td>${price}</td><td>${revenue}</td>
                  <td><button onclick="deleteSale(${idx})">刪除</button></td>`;
    tbody.appendChild(tr);
  });
}

// 刪除銷售資料
function deleteSale(idx){
  if(confirm("確定刪除此筆銷售？")){
    salesRecords.splice(idx,1);
    localStorage.setItem('salesRecords',JSON.stringify(salesRecords));
    renderSales();
    updateTotals();
  }
}

// 計算今日統計
function updateTotals(){
  const today = document.getElementById('dateInput').value;
  let totalCost=0,totalRevenue=0;
  salesRecords.forEach(r=>{
    if(r.date===today){
      const p = products[r.productIndex];
      totalCost += p.cost*r.qty;
      totalRevenue += p.price*r.qty;
    }
  });
  document.getElementById('totalCost').textContent=totalCost;
  document.getElementById('totalRevenue').textContent=totalRevenue;
  document.getElementById('totalProfit').textContent=(totalRevenue-totalCost);
}

// 後台渲染商品
function renderBackendProducts(){
  const container = document.getElementById('backendProducts');
  container.innerHTML="";
  products.forEach((p,i)=>{
    const div = document.createElement('div');
    div.className="product-row";
    div.innerHTML=`<span>${p.name}</span>
      成本 <input type="number" value="${p.cost}" onchange="updateProduct(${i},'cost',this.value)">
      售價 <input type="number" value="${p.price}" onchange="updateProduct(${i},'price',this.value)">
      <button onclick="deleteProduct(${i})">刪除</button>`;
    container.appendChild(div);
  });
}
renderBackendProducts();

// 更新商品
function updateProduct(idx,field,value){
  value=parseFloat(value);
  products[idx][field]=value;
  localStorage.setItem('products',JSON.stringify(products));
  updateProductSelect();
  renderSales();
  renderBackendProducts();
}

// 刪除商品
function deleteProduct(idx){
  if(confirm("確定刪除此商品？")){
    products.splice(idx,1);
    localStorage.setItem('products',JSON.stringify(products));
    updateProductSelect();
    renderSales();
    renderBackendProducts();
  }
}

// 後台新增商品
document.getElementById('addProductBtn').addEventListener('click',()=>{
  const name=document.getElementById('newProductName').value.trim();
  const price=parseFloat(document.getElementById('newProductPrice').value);
  const cost=parseFloat(document.getElementById('newProductCost').value);
  if(!name || isNaN(price) || isNaN(cost)) return alert("請填完整商品資訊！");
  products.push({name, price, cost});
  localStorage.setItem('products',JSON.stringify(products));
  updateProductSelect();
  renderBackendProducts();
  document.getElementById('newProductName').value="";
  document.getElementById('newProductPrice').value="";
  document.getElementById('newProductCost').value="";
});
</script>
</body>
</html>
