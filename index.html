<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點記帳 (密碼後台)</title>
<style>
body { font-family: Arial; max-width:700px; margin:auto; padding:16px; background:#f2f2f7; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; }
th { background:#f0f0f0; }
.form-card { background:#fff; border-radius:14px; padding:10px 12px 14px; margin-bottom:12px; box-shadow: 0 1px 2px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.06); font-size:1.4em; }
input, select, button { font-size:1.2em; padding:8px; margin:4px; width:100%; box-sizing:border-box; border-radius:10px; }
#addBtn { background:#007aff; color:#fff; border:none; }
#totals { font-size:1.2em; padding:10px; background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
#backendWrapper { display:none; }
</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<!-- 前台輸入區 -->
<div class="form-card">
  日期<br>
  <input type="date" id="dateInput">
</div>

<div class="form-card">
  商品<br>
  <select id="productSelect"></select>
</div>

<div class="form-card">
  份數<br>
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="form-card">
  <button id="addBtn">新增銷售</button>
</div>

<!-- 銷售表格 -->
<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>利潤</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 今日統計 -->
<div id="totals" class="form-card">
  <strong>今日總成本：</strong><span id="totalCost">0</span> 元<br>
  <strong>今日總收入：</strong><span id="totalRevenue">0</span> 元<br>
  <strong>今日總利潤：</strong><span id="totalProfit">0</span> 元
</div>

<!-- 後台密碼 -->
<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<!-- 後台管理區 -->
<div id="backendWrapper">
  <h3>後台管理（成本 / 售價 / 刪除 / 新增商品）</h3>

  <!-- 現有商品 -->
  <div id="backendProducts"></div>

  <!-- 新增商品 -->
  <div class="form-card">
    <h4>新增商品</h4>
    商品名稱: <input type="text" id="newProductName" placeholder="名稱">
    成本: <input type="number" id="newProductCost" placeholder="成本">
    售價: <input type="number" id="newProductPrice" placeholder="售價">
    <button onclick="addProduct()">新增商品</button>
  </div>
</div>

<script>
// ===== 後台密碼 =====
const correctPassword = "1234"; // 可修改
document.getElementById('unlockBtn').addEventListener('click', () => {
  const pwd = document.getElementById('adminPassword').value;
  if(pwd === correctPassword){
    document.getElementById('backendWrapper').style.display = "block";
    alert("後台已開啟！");
    document.getElementById('adminPassword').value = "";
  } else {
    alert("密碼錯誤！");
  }
});

// ===== 商品資料 =====
let products = JSON.parse(localStorage.getItem('products')) || [
  {name:'雞蛋糕', price:50, cost:20},
  {name:'奶酪杯', price:60, cost:25},
  {name:'提拉米蘇杯', price:70, cost:30},
  {name:'雪媚娘', price:55, cost:25},
  {name:'紅糖糍粑', price:40, cost:15},
  {name:'奶茶凍', price:50, cost:20},
  {name:'桂花奶酪', price:60, cost:25},
  {name:'華夫餅', price:65, cost:30}
];

let salesRecords = JSON.parse(localStorage.getItem('salesRecords')) || [];

// ===== 更新前台商品下拉 =====
function updateProductSelect(){
  const select = document.getElementById('productSelect');
  select.innerHTML='';
  products.forEach(p=>{
    const opt = document.createElement('option');
    opt.value = p.name;
    opt.innerText = p.name;
    select.appendChild(opt);
  });
}

// ===== 後台渲染商品 =====
function renderBackend(){
  const container = document.getElementById('backendProducts');
  container.innerHTML='';
  products.forEach((p,idx)=>{
    const div = document.createElement('div');
    div.className='form-card';
    div.innerHTML = `
      ${p.name} 成本 <input type="number" value="${p.cost}" onchange="updateProduct(${idx}, 'cost', this.value)">
      售價 <input type="number" value="${p.price}" onchange="updateProduct(${idx}, 'price', this.value)">
      <button onclick="deleteProduct(${idx})">刪除商品</button>
    `;
    container.appendChild(div);
  });
  updateProductSelect();
}
renderBackend();

// ===== 更新商品 =====
function updateProduct(idx, field, value){
  if(field==='price' || field==='cost') value=parseFloat(value);
  products[idx][field]=value;
  localStorage.setItem('products', JSON.stringify(products));
  renderBackend();
}

// ===== 刪除商品 =====
function deleteProduct(idx){
  if(confirm('確定刪除這個商品？')){
    products.splice(idx,1);
    localStorage.setItem('products', JSON.stringify(products));
    renderBackend();
  }
}

// ===== 新增商品 =====
function addProduct(){
  const name = document.getElementById('newProductName').value.trim();
  const cost = parseFloat(document.getElementById('newProductCost').value);
  const price = parseFloat(document.getElementById('newProductPrice').value);

  if(!name || isNaN(cost) || isNaN(price)){
    alert("請輸入完整資訊！");
    return;
  }

  products.push({name, cost, price});
  localStorage.setItem('products', JSON.stringify(products));
  renderBackend();

  document.getElementById('newProductName').value='';
  document.getElementById('newProductCost').value='';
  document.getElementById('newProductPrice').value='';
}

// ===== 新增銷售 =====
document.getElementById('addBtn').addEventListener('click', () => {
  const date = document.getElementById('dateInput').value;
  const productName = document.getElementById('productSelect').value;
  const qty = parseInt(document.getElementById('qtyInput').value);

  if(!date || !productName || !qty){
    alert("請填寫完整資訊！");
    return;
  }

  const product = products.find(p=>p.name===productName);
  const revenue = product.price * qty;
  const profit = revenue - (product.cost * qty);

  salesRecords.push({date, productName, qty, cost:product.cost, price:product.price, revenue, profit});
  localStorage.setItem('salesRecords', JSON.stringify(salesRecords));

  renderSales();
  document.getElementById('qtyInput').value = 1;
});

// ===== 渲染銷售表格 =====
function renderSales(){
  const tbody = document.querySelector('#salesTable tbody');
  tbody.innerHTML='';
  let totalCost=0, totalRevenue=0, totalProfit=0;

  salesRecords.forEach((r,idx)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.date}</td>
      <td>${r.productName}</td>
      <td>${r.qty}</td>
      <td>${r.cost}</td>
      <td>${r.price}</td>
      <td>${r.revenue}</td>
      <td>${r.profit}</td>
      <td><button onclick="deleteSale(${idx})">刪除</button></td>
    `;
    tbody.appendChild(tr);

    // 今日統計
    const today = document.getElementById('dateInput').value;
    if(r.date === today){
      totalCost += r.cost*r.qty;
      totalRevenue += r.revenue;
      totalProfit += r.profit;
    }
  });

  document.getElementById('totalCost').textContent = totalCost;
  document.getElementById('totalRevenue').textContent = totalRevenue;
  document.getElementById('totalProfit').textContent = totalProfit;
}
renderSales();

// ===== 刪除銷售 =====
function deleteSale(idx){
  if(confirm('確定刪除這筆銷售紀錄？')){
    salesRecords.splice(idx,1);
    localStorage.setItem('salesRecords', JSON.stringify(salesRecords));
    renderSales();
  }
}

// 每次選日期更新統計
document.getElementById('dateInput').addEventListener('change', renderSales);

</script>

</body>
</html>
