<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點銷售記帳</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial;
  background:#f2f2f7;
  max-width:700px;
  margin:auto;
  padding:16px;
}

/* 通用卡片 */
.card {
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:14px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  text-align:center;
}

/* 所有輸入安全設定 */
input, select, button {
  font-size:16px;
  height:44px;
  width:100%;
  box-sizing:border-box;
  border:none;
  border-radius:12px;
  background:#f2f2f7;
  text-align:center;
}

/* 日期輸入框 */
#dateInput {
  background: #fff;   
  border: none;       
  width: 60%;         
  max-width: 300px;   
  margin: 0 auto;     
  display: block;     
  text-align: center; 
  height: 32px;       
  line-height: 32px;  
  border-radius: 8px; 
}

/* 商品選擇欄文字置中 */
#productSelect {
  width: 60%;
  max-width: 300px;
  margin: 0 auto;
  display: block;
  text-align-last: center;     
  -moz-text-align-last: center; 
  -webkit-appearance: none;    
  appearance: none;
  height: 32px;
  border-radius: 8px;
  background: #fff;
}

/* 按鈕 */
button {
  background:#007aff;
  color:#fff;
}

/* 表格 */
table {
  width:100%;
  border-collapse:collapse;
}
th, td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center; 
}
th {
  background:#f0f0f0;
}

/* 後台密碼列 */
.admin-row {
  display:flex;
  gap:10px;
}
.admin-row input,
.admin-row button {
  flex:1;
}

/* 後台商品卡片 */
.product-card {
  border:1px solid #ddd;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}

/* 商品成本/售價列 */
.product-row {
  display:flex;
  justify-content:space-between;
  gap:4%;
}
.product-row div input {
  width:100%;
  margin-top:4px;
}

/* 今日統計區塊固定數字寬度 */
#statsCard {
  display:flex;
  justify-content:space-between;
  text-align:center;
}
#statsCard div span {
  display:inline-block;
  width:60px;
}
</style>
</head>
<body>

<h2 style="text-align:center">甜點銷售記帳</h2>

<!-- 第一層：輸入代號 -->
<div class="card" id="codeCard">
  輸入代號
  <div style="display:flex; gap:10px;">
    <input type="text" id="userCode" placeholder="代號">
    <button onclick="enterCode()">確定</button>
  </div>
</div>

<!-- 第二層：主程式區塊 -->
<div id="mainCard" style="display:none">

  <!-- 日期 -->
  <div class="card">
    日期
    <input type="date" id="dateInput">
  </div>

  <!-- 商品 -->
  <div class="card">
    商品
    <select id="productSelect"></select>
  </div>

  <!-- 份數 -->
  <div class="card">
    份數
    <input type="number" id="qtyInput" min="1" value="1">
  </div>

  <!-- 新增 -->
  <div class="card">
    <button onclick="addSale()">新增銷售</button>
  </div>

  <!-- 銷售表格 -->
  <div class="card">
  <table>
    <thead>
      <tr>
        <th>日期</th><th>商品</th><th>份數</th><th>收入</th><th>刪除</th>
      </tr>
    </thead>
    <tbody id="salesList"></tbody>
  </table>
  </div>

  <!-- 今日統計 -->
  <div class="card" id="statsCard">
    <div>今日成本<br><span id="totalCost">0</span></div>
    <div>今日收入<br><span id="totalRevenue">0</span></div>
    <div>今日利潤<br><span id="totalProfit">0</span></div>
  </div>

  <!-- 後台密碼 -->
  <div class="card">
    <div class="admin-row">
      <input type="password" id="adminPwd" placeholder="後台密碼">
      <button onclick="unlockBackend()">進入後台</button>
    </div>
  </div>

  <!-- 後台 -->
  <div id="backend" style="display:none" class="card">
    <h3>商品管理</h3>
    <div id="productList"></div>

    <!-- 新增商品區 -->
    <div class="product-card">
      <div style="margin-bottom:6px; font-weight:bold;">新增商品</div>
      <div class="product-row">
        <div style="flex:1; text-align:center;">商品名稱
          <input id="newName" placeholder="名稱">
        </div>
        <div style="flex:1; text-align:center;">成本
          <input id="newCost" type="number" placeholder="成本">
        </div>
        <div style="flex:1; text-align:center;">售價
          <input id="newPrice" type="number" placeholder="售價">
        </div>
      </div>
      <button onclick="addProduct()" style="margin-top:6px;">新增商品</button>
    </div>

  </div>
</div>

<script>
// 使用者代號
let userCode = "";

// 範例產品資料
let products=[
  {name:"雞蛋糕",cost:20,price:50},
  {name:"奶酪杯",cost:25,price:60},
  {name:"提拉米蘇杯",cost:30,price:70},
  {name:"雪媚娘",cost:25,price:55},
  {name:"紅糖糍粑",cost:15,price:40},
  {name:"奶茶凍",cost:20,price:50},
  {name:"桂花奶酪",cost:25,price:60},
  {name:"華夫餅",cost:30,price:65}
];

let sales=[];

// 輸入代號
function enterCode(){
  const code = document.getElementById("userCode").value.trim();
  if(!code){ alert("請輸入代號"); return; }
  userCode = code;
  document.getElementById("codeCard").style.display="none";
  document.getElementById("mainCard").style.display="block";
  updateSelect();
}

// 更新商品選單
function updateSelect(){
  const s=document.getElementById("productSelect");
  s.innerHTML="";
  products.forEach((p,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=p.name;
    s.appendChild(o);
  });
}

// 新增銷售
function addSale(){
  const d=document.getElementById("dateInput").value;
  const i=document.getElementById("productSelect").value;
  const q=parseInt(document.getElementById("qtyInput").value);
  if(!d||q<=0) return;
  sales.push({d,i,q,user:userCode}); // 帶上代號
  saveSales();
  renderSales();
}

// 顯示銷售列表
function renderSales(){
  const list=document.getElementById("salesList");
  list.innerHTML="";
  let cost=0,rev=0;
  sales.forEach((s,idx)=>{
    const p=products[s.i];
    const r=p.price*s.q;
    cost+=p.cost*s.q;
    rev+=r;
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${s.d.slice(5)}</td>
      <td>${p.name}</td>
      <td>${s.q}</td>
      <td>${r}</td>
      <td><button onclick="delSale(${idx})">刪除</button></td>`;
    list.appendChild(tr);
  });
  document.getElementById("totalCost").textContent=cost;
  document.getElementById("totalRevenue").textContent=rev;
  document.getElementById("totalProfit").textContent=rev-cost;
}

// 刪除銷售
function delSale(i){
  if(confirm("確定刪除這筆銷售？")){
    sales.splice(i,1);
    saveSales();
    renderSales();
  }
}

// 後台管理
const adminPassword="1234";
function unlockBackend(){
  if(document.getElementById("adminPwd").value===adminPassword){
    document.getElementById("backend").style.display="block";
  } else alert("密碼錯誤");
}

// 渲染後台商品列表
function renderBackend(){
  const box=document.getElementById("productList");
  box.innerHTML="";
  products.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="product-card";
    d.innerHTML=`
      <div style="margin-bottom:6px; font-weight:bold;">${p.name}</div>
      <div class="product-row">
        <div style="flex:1; text-align:center;">成本<input value="${p.cost}" onchange="updateP(${i},'cost',this.value)"></div>
        <div style="flex:1; text-align:center;">售價<input value="${p.price}" onchange="updateP(${i},'price',this.value)"></div>
      </div>
      <button onclick="delProduct(${i})" style="margin-top:6px;">刪除商品</button>`;
    box.appendChild(d);
  });
}

function updateP(i,f,v){
  products[i][f]=parseFloat(v);
  updateSelect(); renderSales(); renderBackend();
}

function delProduct(i){
  if(confirm("確定刪除商品？")){
    products.splice(i,1);
    updateSelect(); renderBackend(); renderSales();
  }
}

function addProduct(){
  const n=newName.value;
  const c=parseFloat(newCost.value);
  const p=parseFloat(newPrice.value);
  if(!n||!c||!p) return;
  products.push({name:n,cost:c,price:p});
  updateSelect(); renderBackend();
  newName.value=newCost.value=newPrice.value="";
}

// 模擬存 Google Sheet
function saveSales(){
  console.log("回傳 Google Sheet:", sales);
}

// 初始化
updateSelect(); renderBackend();
</script>
</body>
</html>
