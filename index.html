<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”œé»éŠ·å”®è¨˜å¸³</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial;
  background:#f2f2f7;
  max-width:700px;
  margin:auto;
  padding:16px;
}

.card {
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:14px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  text-align:center;
}

input, select, button {
  font-size:16px;
  height:40px;
  width:100%;
  border:none;
  border-radius:10px;
  background:#f2f2f7;
  text-align:center;
}

#dateInput, #productSelect {
  background:#fff;
  width:60%;
  max-width:300px;
  margin:0 auto;
  display:block;
}

button {
  background:#007aff;
  color:#fff;
}

/* é®ç½© */
#lock {
  position:fixed;
  inset:0;
  background:#f2f2f7;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99;
}
</style>
</head>

<body>

<!-- ğŸ”’ ä»£è™Ÿè¼¸å…¥é®ç½© -->
<div id="lock">
  <div class="card" style="width:80%">
    <h3>è«‹è¼¸å…¥ä»£è™Ÿ</h3>
    <input id="codeInput" placeholder="ä»£è™Ÿ">
    <br><br>
    <button onclick="unlock()">é€²å…¥</button>
  </div>
</div>

<h2 style="text-align:center">ç”œé»éŠ·å”®è¨˜å¸³</h2>

<div class="card">
  æ—¥æœŸ
  <input type="date" id="dateInput">
</div>

<div class="card">
  å•†å“
  <select id="productSelect"></select>
</div>

<div class="card">
  ä»½æ•¸
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="card">
  <button onclick="addSale()">æ–°å¢éŠ·å”®</button>
</div>

<script>
/* ====== è¨­å®š ====== */
const GAS_URL = "è«‹è²¼ä¸Šä½ çš„ GAS Web App ç¶²å€";
let products = [];
let userCode = "";

/* è§£é– */
function unlock() {
  const c = document.getElementById("codeInput").value.trim();
  if (!c) {
    alert("è«‹è¼¸å…¥ä»£è™Ÿ");
    return;
  }
  userCode = c;
  document.getElementById("lock").style.display = "none";
}

/* è®€å•†å“ */
function loadProducts() {
  fetch(`${GAS_URL}?type=products`)
    .then(r => r.json())
    .then(data => {
      products = data;
      const s = document.getElementById("productSelect");
      s.innerHTML = "";
      products.forEach((p,i)=>{
        const o = document.createElement("option");
        o.value=i;
        o.textContent=p.name;
        s.appendChild(o);
      });
    });
}

/* æ–°å¢è²©å”® */
function addSale() {
  if (!userCode) {
    alert("è«‹å…ˆè¼¸å…¥ä»£è™Ÿ");
    return;
  }

  const date = dateInput.value;
  const qty = parseInt(qtyInput.value);
  const p = products[productSelect.value];

  if (!date || qty<=0) return;

  fetch(GAS_URL, {
    method:"POST",
    body:JSON.stringify({
      type:"sale",
      code:userCode,     // â† ä»£è™Ÿä¸€ä½µé€å‡º
      date:date,
      product:p.name,
      qty:qty,
      price:p.price
    })
  })
  .then(()=> {
    alert("å·²æ–°å¢");
    qtyInput.value = 1;
  });
}

loadProducts();
</script>

</body>
</html>
