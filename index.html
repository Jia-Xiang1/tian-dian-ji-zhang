<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點銷售記帳</title>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,Arial; max-width:700px; margin:auto; padding:16px; background:#f2f2f7; }
.card { background:#fff; border-radius:14px; padding:12px; margin-bottom:14px; box-shadow:0 2px 8px rgba(0,0,0,0.08); text-align:center; }
input, select, button { font-size:16px; height:44px; width:100%; box-sizing:border-box; border:none; border-radius:12px; background:#f2f2f7; text-align:center; }
#dateInput, #productSelect { background:#fff; width:60%; max-width:300px; margin:0 auto; display:block; height:32px; line-height:32px; border-radius:8px; text-align:center; }
#productSelect { text-align-last:center; -moz-text-align-last:center; -webkit-appearance:none; appearance:none; }
table { width:100%; border-collapse:collapse; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#f0f0f0; }
#stats { display:flex; justify-content:space-around; font-weight:bold; padding:8px 0; }
.admin-row { display:flex; gap:10px; }
.admin-row input, .admin-row button { flex:1; }
.product-card { border:1px solid #ddd; border-radius:12px; padding:10px; margin-bottom:10px; }
.product-row { display:flex; justify-content:space-between; gap:4%; }
.product-row div input { width:100%; margin-top:4px; }
</style>
</head>
<body>

<h2 style="text-align:center">甜點銷售記帳</h2>

<!-- 登入代號 -->
<div class="card" id="loginCard">
  輸入代號
  <input type="text" id="userCode" placeholder="代號">
  <button onclick="loginUser()">登入</button>
</div>

<!-- 主界面 -->
<div id="mainInterface" style="display:none">

  <div class="card">日期<input type="date" id="dateInput"></div>
  <div class="card">商品<select id="productSelect"></select></div>
  <div class="card">份數<input type="number" id="qtyInput" min="1" value="1"></div>
  <div class="card"><button onclick="addSale()">新增銷售</button></div>

  <div class="card">
    <table>
      <thead><tr><th>日期</th><th>商品</th><th>份數</th><th>收入</th><th>刪除</th></tr></thead>
      <tbody id="salesList"></tbody>
    </table>
  </div>

  <div class="card" id="stats">
    <div>今日成本：<span id="totalCost">0</span></div>
    <div>今日收入：<span id="totalRevenue">0</span></div>
    <div>今日利潤：<span id="totalProfit">0</span></div>
  </div>

</div>

<script>
let userCode = "";
let products = [
  {name:"雞蛋糕", cost:20, price:50},
  {name:"奶酪杯", cost:25, price:60},
  {name:"提拉米蘇杯", cost:30, price:70},
  {name:"雪媚娘", cost:25, price:55},
  {name:"紅糖糍粑", cost:15, price:40},
  {name:"奶茶凍", cost:20, price:50},
  {name:"桂花奶酪", cost:25, price:60},
  {name:"華夫餅", cost:30, price:65}
];
let sales = [];
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyC9yRDuelmE8HMGrlScchdTVviozoJ31LJEBS6kquRq9qBUr-hBJCToSQ5-7rNnuwPGg/exec"; // 改成你的 Web App URL

function loginUser(){
  const code = document.getElementById("userCode").value.trim();
  if(!code){ alert("請輸入代號"); return; }
  userCode = code;
  document.getElementById("loginCard").style.display="none";
  document.getElementById("mainInterface").style.display="block";
  updateSelect(); renderSales();
}

function updateSelect(){
  const s = document.getElementById("productSelect");
  s.innerHTML="";
  products.forEach((p,i)=>{
    const o = document.createElement("option");
    o.value = i;
    o.textContent = p.name;
    s.appendChild(o);
  });
}

function addSale(){
  const d = document.getElementById("dateInput").value;
  const i = document.getElementById("productSelect").value;
  const q = parseInt(document.getElementById("qtyInput").value);
  if(!d || q<=0){ alert("請填寫完整資料"); return; }
  const p = products[i];

  const saleData = {
    日期: d,
    商品: p.name,
    份數: q,
    單價: p.price,
    人員: userCode
  };

  fetch(WEB_APP_URL, {
    method:"POST",
    body: JSON.stringify(saleData),
    headers: {"Content-Type":"application/json"}
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="success"){ sales.push(saleData); renderSales(); }
    else alert("傳送失敗："+res.msg);
  })
  .catch(e=>{ alert("傳送錯誤"); console.log(e); });
}

function renderSales(){
  const list = document.getElementById("salesList");
  list.innerHTML="";
  let cost=0, rev=0;
  sales.forEach((s,idx)=>{
    const r = s.單價*s.份數;
    const c = products.find(p=>p.name===s.商品)?.cost*s.份數||0;
    cost+=c; rev+=r;
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${s.日期.slice(5)}</td><td>${s.商品}</td><td>${s.份數}</td><td>${r}</td><td><button onclick="delSale(${idx})">刪除</button></td>`;
    list.appendChild(tr);
  });
  document.getElementById("totalCost").textContent=cost;
  document.getElementById("totalRevenue").textContent=rev;
  document.getElementById("totalProfit").textContent=rev-cost;
}

function delSale(i){ if(confirm("確定刪除這筆銷售？")){ sales.splice(i,1); renderSales(); } }

</script>
</body>
</html>
