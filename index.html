<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>甜點記帳</title>
<style>
body { font-family: Arial; max-width:700px; margin:auto; padding:16px; background:#f2f2f7; }

.form-card { 
  background:#fff; 
  border-radius:12px; 
  padding:10px 12px 14px; 
  margin-bottom:12px; 
  box-shadow: 0 1px 2px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.06); 
  font-size:1.4em; 
}

input[type="date"], input[type="number"] {
  width:100%; 
  font-size:1.2em; 
  padding:6px; 
  text-align:center; 
  box-sizing:border-box;
}

button { 
  width:100%; 
  font-size:1.2em; 
  padding:8px; 
  border:none; 
  border-radius:12px; 
  background:#007aff; 
  color:#fff; 
  cursor:pointer;
}

table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; border-radius:12px; overflow:hidden; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#f0f0f0; }

#totals { font-size:1.2em; padding:10px; background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:12px; }

.custom-select { position: relative; font-size:1.2em; width:100%; background:#f2f2f7; border-radius:10px; border:1px solid #d1d1d6; cursor:pointer; box-sizing:border-box; }
.custom-select .selected { padding:10px; text-align:center; }
.custom-select .options { display:none; position:absolute; top:100%; left:0; width:100%; background:#fff; border-radius:10px; border:1px solid #d1d1d6; max-height:200px; overflow-y:auto; z-index:100; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
.custom-select .option { padding:10px; text-align:center; }
.custom-select .option:hover { background:#e5e5ea; }

/* 後台商品格式三行 */
.backend-product { background:#fff; border-radius:12px; padding:8px; margin-bottom:10px; box-shadow:0 1px 3px rgba(0,0,0,0.08); }
.backend-product .name, .backend-product .costprice, .backend-product .deletebtn { margin-bottom:6px; font-size:1.2em; }

</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<!-- 日期 -->
<div class="form-card">
  日期<br>
  <input type="date" id="dateInput">
</div>

<!-- 商品 -->
<div class="form-card">
  商品<br>
  <div class="custom-select" id="customProductSelect">
    <div class="selected">雞蛋糕</div>
    <div class="options"></div>
  </div>
</div>

<!-- 份數 -->
<div class="form-card">
  份數<br>
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<!-- 新增銷售 -->
<div class="form-card">
  <button id="addBtn">新增銷售</button>
</div>

<!-- 銷售表格 -->
<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 今日統計 -->
<div id="totals">
  今日總成本: <span id="totalCost">0</span> 元<br>
  今日總收入: <span id="totalRevenue">0</span> 元<br>
  今日總利潤: <span id="totalProfit">0</span> 元
</div>

<!-- 後台密碼 -->
<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<!-- 後台商品管理 -->
<div id="backendWrapper" style="display:none;">
  <h3>後台設定成本與售價 / 新增商品</h3>
  <div id="backendProducts"></div>
  <div class="backend-product">
    <div class="name">名稱: <input type="text" id="newProductName" placeholder="商品名稱"></div>
    <div class="costprice">成本: <input type="number" id="newProductCost"> 售價: <input type="number" id="newProductPrice"></div>
    <div class="deletebtn"><button onclick="addNewProduct()">新增商品</button></div>
  </div>
</div>

<script>
// 初始商品
let products = [
  {name:'雞蛋糕', cost:20, price:50},
  {name:'奶酪杯', cost:25, price:60},
  {name:'提拉米蘇杯', cost:30, price:70},
  {name:'雪媚娘', cost:25, price:55},
  {name:'紅糖糍粑', cost:15, price:40},
  {name:'奶茶凍', cost:20, price:50},
  {name:'桂花奶酪', cost:25, price:60},
  {name:'華夫餅', cost:30, price:65}
];

let salesRecords = [];

// 假選單
const select = document.getElementById('customProductSelect');
const selected = select.querySelector('.selected');
const optionsContainer = select.querySelector('.options');

function refreshOptions(){
  optionsContainer.innerHTML='';
  products.forEach(p=>{
    const opt=document.createElement('div'); 
    opt.className='option'; 
    opt.textContent=p.name;
    opt.addEventListener('click',()=>{ selected.textContent=p.name; optionsContainer.style.display='none'; });
    optionsContainer.appendChild(opt);
  });
}
refreshOptions();

selected.addEventListener('click',()=>{ optionsContainer.style.display = optionsContainer.style.display==='block' ? 'none':'block'; });
document.addEventListener('click', e=>{ if(!select.contains(e.target)) optionsContainer.style.display='none'; });

// 新增銷售
document.getElementById('addBtn').addEventListener('click',()=>{
  const date = document.getElementById('dateInput').value;
  const productName = selected.textContent;
  const qty = parseInt(document.getElementById('qtyInput').value);
  if(!date || !productName || !qty) return alert('請填寫完整資訊');

  const prod = products.find(p=>p.name===productName);
  const revenue = prod.price * qty;

  const tbody = document.querySelector('#salesTable tbody');
  const tr=document.createElement('tr');
  const d = new Date(date);
  const displayDate = (d.getMonth()+1)+'/'+d.getDate();
  tr.innerHTML=`<td>${displayDate}</td><td>${prod.name}</td><td style="text-align:center">${qty}</td><td>${prod.cost}</td><td>${prod.price}</td><td>${revenue}</td><td><button onclick="deleteSale(this)">刪除</button></td>`;
  tbody.appendChild(tr);
  salesRecords.push({date:displayDate, product:prod.name, qty, cost:prod.cost, price:prod.price, revenue});
  updateTotals();
  document.getElementById('qtyInput').value=1;
});

function deleteSale(btn){
  if(confirm('確定刪除這筆資料？')){
    const row = btn.closest('tr');
    const idx = Array.from(row.parentNode.children).indexOf(row);
    salesRecords.splice(idx,1);
    row.remove();
    updateTotals();
  }
}

function updateTotals(){
  const today = document.getElementById('dateInput').value;
  const d = new Date(today);
  const todayStr = (d.getMonth()+1)+'/'+d.getDate();
  let totalCost=0, totalRevenue=0;
  salesRecords.forEach(r=>{ if(r.date===todayStr){ totalCost+=r.cost*r.qty; totalRevenue+=r.revenue; }});
  document.getElementById('totalCost').textContent=totalCost;
  document.getElementById('totalRevenue').textContent=totalRevenue;
  document.getElementById('totalProfit').textContent=totalRevenue-totalCost;
}

// 後台密碼
const correctPassword = '1234';
document.getElementById('unlockBtn').addEventListener('click',()=>{
  const pwd = document.getElementById('adminPassword').value;
  if(pwd===correctPassword){
    document.getElementById('backendWrapper').style.display='block';
    alert('後台已開啟！');
    document.getElementById('adminPassword').value='';
    renderBackendProducts();
  }else alert('密碼錯誤！');
});

// 後台渲染商品
function renderBackendProducts(){
  const container = document.getElementById('backendProducts');
  container.innerHTML='';
  products.forEach((p,i)=>{
    const div=document.createElement('div'); div.className='backend-product';
    div.innerHTML=`
      <div class="name">${p.name}</div>
      <div class="costprice">成本: <input type="number" value="${p.cost}" onchange="updateProduct(${i}, 'cost', this.value)"> 售價: <input type="number" value="${p.price}" onchange="updateProduct(${i}, 'price', this.value)"></div>
      <div class="deletebtn"><button onclick="deleteProduct(${i})">刪除商品</button></div>
    `;
    container.appendChild(div);
  });
}

function updateProduct(idx, field, value){
  products[idx][field]=parseFloat(value);
  refreshOptions();
}

function deleteProduct(idx){
  if(confirm('確定刪除這個商品？')){
    products.splice(idx,1);
    refreshOptions();
    renderBackendProducts();
  }
}

// 新增商品
function addNewProduct(){
  const name = document.getElementById('newProductName').value.trim();
  const cost = document.getElementById('newProductCost').value;
  const price = document.getElementById('newProductPrice').value;
  if(!name || !cost || !price) return alert('請填寫完整資訊');
  products.push({name, cost:parseFloat(cost), price:parseFloat(price)});
  refreshOptions();
  renderBackendProducts();
  document.getElementById('newProductName').value='';
  document.getElementById('newProductCost').value='';
  document.getElementById('newProductPrice').value='';
}
</script>
</body>
</html>
