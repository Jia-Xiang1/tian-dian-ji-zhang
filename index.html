<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>甜點記帳 PWA</title>
<link rel="manifest" href="manifest.json">
<style>
body {
  font-family: Arial, sans-serif;
  max-width:700px;
  margin:auto;
  padding:16px;
  background:#f2f2f7;
}

/* 統一輸入區塊 */
.form-card {
  background:#fff;
  border-radius:12px;
  padding:12px 14px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  font-size:16px;
}

.form-card input,
.form-card select,
.form-card button {
  font-size:16px;
  padding:8px;
  width:100%;
  box-sizing:border-box;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:6px;
  -webkit-appearance: none;
  text-align:center;
}

input[type="date"] {
  -webkit-appearance: none;
}

button {
  background:#007aff;
  color:#fff;
  border:none;
}

/* 表格 */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th, td {
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}

th {
  background:#f0f0f0;
}

/* 今日統計 */
#totals {
  background:#fff;
  border-radius:12px;
  padding:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  margin-top:12px;
}

/* 後台區塊 */
#backendWrapper {
  display:none;
  margin-top:12px;
}

#backendWrapper input {
  font-size:16px;
  width:80px;
  margin-right:6px;
}
</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<!-- 前台輸入區 -->
<div class="form-card">
  日期<br>
  <input type="date" id="dateInput">
</div>

<div class="form-card">
  商品<br>
  <select id="productSelect"></select>
</div>

<div class="form-card">
  份數<br>
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="form-card">
  <button id="addBtn">新增</button>
</div>

<!-- 表格 -->
<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 今日統計 -->
<div id="totals" class="form-card">
  <strong>今日總成本：</strong><span id="totalCost">0</span> 元<br>
  <strong>今日總收入：</strong><span id="totalRevenue">0</span> 元<br>
  <strong>今日總利潤：</strong><span id="totalProfit">0</span> 元
</div>

<!-- 後台密碼 -->
<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<!-- 後台管理 -->
<div id="backendWrapper" class="form-card">
  <h3>後台設定成本與售價</h3>
  <div id="productBackendList"></div>
  <div style="margin-top:10px;">
    新增商品: <input type="text" id="newProductName" placeholder="商品名稱">
    成本 <input type="number" id="newProductCost" value="0">
    售價 <input type="number" id="newProductPrice" value="0">
    <button onclick="addProduct()">新增</button>
  </div>
</div>

<script>
// ===== 後台密碼 =====
const correctPassword = "1234"; // 可修改
document.getElementById('unlockBtn').addEventListener('click', ()=>{
  const pwd = document.getElementById('adminPassword').value;
  if(pwd===correctPassword){
    document.getElementById('backendWrapper').style.display='block';
    alert('後台已開啟！');
    document.getElementById('adminPassword').value='';
  } else {
    alert('密碼錯誤！');
  }
});

// ===== 初始商品與銷售資料 =====
let products = JSON.parse(localStorage.getItem('products')) || [
  {name:'雞蛋糕', cost:10, price:20},
  {name:'奶酪杯', cost:8, price:15},
  {name:'提拉米蘇杯', cost:12, price:25},
  {name:'雪媚娘', cost:9, price:18},
  {name:'紅糖糍粑', cost:7, price:14},
  {name:'奶茶凍', cost:8, price:16},
  {name:'桂花奶酪', cost:9, price:17},
  {name:'華夫餅', cost:10, price:20}
];
let salesRecords = JSON.parse(localStorage.getItem('salesRecords')) || [];

// ===== 更新前台商品下拉 =====
function updateProductSelect(){
  const sel = document.getElementById('productSelect');
  sel.innerHTML='';
  products.forEach((p,i)=>{
    const opt=document.createElement('option');
    opt.value=i; opt.innerText=p.name;
    sel.appendChild(opt);
  });
}
updateProductSelect();

// ===== 渲染後台商品列表 =====
function renderBackendProducts(){
  const container=document.getElementById('productBackendList');
  container.innerHTML='';
  products.forEach((p,i)=>{
    const div=document.createElement('div');
    div.innerHTML=`${p.name} 成本 <input type="number" value="${p.cost}" onchange="updateProduct(${i}, 'cost', this.value)">
    售價 <input type="number" value="${p.price}" onchange="updateProduct(${i}, 'price', this.value)">
    <button onclick="deleteProduct(${i})">刪除</button>`;
    container.appendChild(div);
  });
}
renderBackendProducts();

// ===== 更新商品價格或成本 =====
function updateProduct(idx, field, value){
  products[idx][field]=parseFloat(value);
  localStorage.setItem('products', JSON.stringify(products));
  updateProductSelect();
  renderBackendProducts();
}

// ===== 刪除商品 =====
function deleteProduct(idx){
  if(confirm('確定刪除這個商品？')){
    products.splice(idx,1);
    localStorage.setItem('products', JSON.stringify(products));
    updateProductSelect();
    renderBackendProducts();
    renderSales();
  }
}

// ===== 新增商品 =====
function addProduct(){
  const name=document.getElementById('newProductName').value.trim();
  const cost=parseFloat(document.getElementById('newProductCost').value);
  const price=parseFloat(document.getElementById('newProductPrice').value);
  if(!name || isNaN(cost) || isNaN(price)) return alert('請填寫完整資訊！');
  products.push({name,cost,price});
  localStorage.setItem('products', JSON.stringify(products));
  updateProductSelect();
  renderBackendProducts();
  document.getElementById('newProductName').value='';
  document.getElementById('newProductCost').value=0;
  document.getElementById('newProductPrice').value=0;
}

// ===== 新增銷售 =====
document.getElementById('addBtn').addEventListener('click', ()=>{
  const date=document.getElementById('dateInput').value;
  const idx=parseInt(document.getElementById('productSelect').value);
  const qty=parseInt(document.getElementById('qtyInput').value);
  if(!date || isNaN(idx) || !qty || qty<1) return alert('請輸入完整資訊！');

  const p=products[idx];
  const revenue=p.price*qty;

  salesRecords.push({date, product: p.name, qty, cost:p.cost, price:p.price, revenue});
  localStorage.setItem('salesRecords', JSON.stringify(salesRecords));
  renderSales();
  document.getElementById('qtyInput').value=1;
});

// ===== 渲染銷售表格 =====
function renderSales(){
  const tbody=document.querySelector('#salesTable tbody');
  tbody.innerHTML='';
  let totalCost=0, totalRevenue=0;
  salesRecords.forEach((r,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.date}</td><td>${r.product}</td><td>${r.qty}</td><td>${r.cost}</td>
    <td>${r.price}</td><td>${r.revenue}</td>
    <td><button onclick="deleteSale(${idx})">刪除</button></td>`;
    tbody.appendChild(tr);
    totalCost+=r.cost*r.qty;
    totalRevenue+=r.revenue;
  });
  document.getElementById('totalCost').textContent=totalCost;
  document.getElementById('totalRevenue').textContent=totalRevenue;
  document.getElementById('totalProfit').textContent=totalRevenue-totalCost;
}
renderSales();

// ===== 刪除銷售 =====
function deleteSale(idx){
  if(confirm('確定刪除這筆銷售資料？')){
    salesRecords.splice(idx,1);
    localStorage.setItem('salesRecords', JSON.stringify(salesRecords));
    renderSales();
  }
}
</script>

</body>
</html>
