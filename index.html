<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點記帳</title>
<style>
body { 
  font-family: Arial; 
  max-width:700px; 
  margin:auto; 
  padding:16px; 
  background:#f2f2f7;
}

.form-card {
  background:#fff;
  border-radius:12px;
  padding:10px 12px 14px;
  margin-bottom:12px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.06);
}

input, select, button {
  box-sizing:border-box;
}

#dateInput, #qtyInput, #adminPassword {
  font-size:16px; /* 防止 iPhone 自動放大 */
}

#dateInput {
  width:100%;
  text-align:center;
  padding:6px;
}

#qtyInput {
  width:100%;
  text-align:center;
  padding:6px;
}

.custom-select {
  position: relative;
  font-size:16px;
  width:100%;
  background: #f2f2f7;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
  cursor: pointer;
}

.custom-select .selected {
  padding: 10px;
  text-align: center;
}

.custom-select .options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: #fff;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
  max-height: 200px;
  overflow-y: auto;
  z-index: 100;
}

.custom-select .option {
  padding: 10px;
  text-align: center;
}

.custom-select .option:hover {
  background: #e5e5ea;
}

#addBtn {
  font-size:16px;
  padding:10px;
  width:100%;
  border:none;
  border-radius:12px;
  background:#007aff;
  color:#fff;
}

table { 
  width:100%; 
  border-collapse:collapse; 
  margin-top:12px; 
}

th, td { 
  border:1px solid #ccc; 
  padding:6px; 
  text-align:center; 
}

th { 
  background:#f0f0f0; 
}

#totals {
  font-size:16px;
  padding:10px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  margin-top:12px;
}

#backendWrapper {
  display:none;
  margin-top:12px;
}

.backend-product {
  display:flex;
  flex-direction:column;
  margin-bottom:8px;
}

.backend-product input {
  margin-top:4px;
  margin-bottom:4px;
  width:100px;
}

</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<div class="form-card">
  日期<br>
  <input type="date" id="dateInput">
</div>

<div class="form-card">
  商品<br>
  <div class="custom-select" id="customProductSelect">
    <div class="selected">雞蛋糕</div>
    <div class="options">
      <div class="option">雞蛋糕</div>
      <div class="option">奶酪杯</div>
      <div class="option">提拉米蘇杯</div>
      <div class="option">雪媚娘</div>
      <div class="option">紅糖糍粑</div>
      <div class="option">奶茶凍</div>
      <div class="option">桂花奶酪</div>
      <div class="option">華夫餅</div>
    </div>
  </div>
</div>

<div class="form-card">
  份數<br>
  <input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="form-card">
  <button id="addBtn">新增</button>
</div>

<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<div id="totals" class="form-card">
  <strong>今日總成本：</strong><span id="totalCost">0</span> 元<br>
  <strong>今日總收入：</strong><span id="totalRevenue">0</span> 元<br>
  <strong>今日總利潤：</strong><span id="totalProfit">0</span> 元
</div>

<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<div id="backendWrapper" class="form-card">
  <h3>後台管理（成本/售價/刪除）</h3>
  <div id="backendProducts"></div>
  <div style="margin-top:8px;">
    新增商品名稱: <input type="text" id="newProductName"> 
    成本: <input type="number" id="newProductCost"> 
    售價: <input type="number" id="newProductPrice">
    <button onclick="addNewProduct()">新增商品</button>
  </div>
</div>

<script>
// ===== 假選單 =====
const select = document.getElementById('customProductSelect');
const selected = select.querySelector('.selected');
const optionsContainer = select.querySelector('.options');
const options = optionsContainer.querySelectorAll('.option');

selected.addEventListener('click', () => {
  optionsContainer.style.display = optionsContainer.style.display === 'block' ? 'none' : 'block';
});

options.forEach(option => {
  option.addEventListener('click', () => {
    selected.textContent = option.textContent;
    optionsContainer.style.display = 'none';
  });
});

document.addEventListener('click', (e) => {
  if (!select.contains(e.target)) optionsContainer.style.display = 'none';
});

// ===== 商品資料 =====
let products = [
  {name:'雞蛋糕', cost:10, price:20},
  {name:'奶酪杯', cost:8, price:15},
  {name:'提拉米蘇杯', cost:12, price:25},
  {name:'雪媚娘', cost:9, price:18},
  {name:'紅糖糍粑', cost:7, price:14},
  {name:'奶茶凍', cost:8, price:16},
  {name:'桂花奶酪', cost:9, price:17},
  {name:'華夫餅', cost:10, price:20}
];

let salesRecords = [];

// ===== 銷售表格 =====
function updateTotals() {
  const rows = document.querySelectorAll('#salesTable tbody tr');
  let totalCost = 0, totalRevenue = 0;
  const today = document.getElementById('dateInput').value;

  rows.forEach(row => {
    const date = row.cells[0].textContent;
    if(date.slice(5) === today.slice(5)) { // 月/日比較
      totalCost += parseFloat(row.cells[3].textContent) * parseInt(row.cells[2].textContent);
      totalRevenue += parseFloat(row.cells[5].textContent);
    }
  });

  document.getElementById('totalCost').textContent = totalCost;
  document.getElementById('totalRevenue').textContent = totalRevenue;
  document.getElementById('totalProfit').textContent = totalRevenue - totalCost;
}

function renderSales() {
  const tbody = document.querySelector('#salesTable tbody');
  tbody.innerHTML = '';
  salesRecords.forEach((r, idx) => {
    const row = document.createElement('tr');
    const dateParts = r.date.split('-');
    row.innerHTML = `<td>${dateParts[1]}/${dateParts[2]}</td><td>${r.product}</td><td>${r.qty}</td><td>${r.cost}</td><td>${r.price}</td><td>${r.price*r.qty}</td><td><button onclick="deleteSale(${idx})">刪除</button></td>`;
    tbody.appendChild(row);
  });
  updateTotals();
}

document.getElementById('addBtn').addEventListener('click', () => {
  const date = document.getElementById('dateInput').value;
  const productName = selected.textContent;
  const qty = parseInt(document.getElementById('qtyInput').value);
  if(!date || !productName || !qty) return alert("請填完整資訊");

  const p = products.find(p=>p.name===productName);
  salesRecords.push({date, product:productName, qty, cost:p.cost, price:p.price});
  renderSales();
});

// ===== 刪除銷售 =====
function deleteSale(idx){
  if(confirm("確定刪除這筆銷售？")){
    salesRecords.splice(idx,1);
    renderSales();
  }
}

// ===== 後台 =====
const correctPassword = "1234";
document.getElementById('unlockBtn').addEventListener('click', () => {
  const pwd = document.getElementById('adminPassword').value;
  if(pwd === correctPassword){
    document.getElementById('backendWrapper').style.display = "block";
    document.getElementById('adminPassword').value="";
    renderBackend();
  } else alert("密碼錯誤");
});

function renderBackend(){
  const container = document.getElementById('backendProducts');
  container.innerHTML='';
  products.forEach((p, idx)=>{
    const div = document.createElement('div');
    div.className = 'backend-product';
    div.innerHTML = `
      <strong>${p.name}</strong><br>
      成本: <input type="number" value="${p.cost}" onchange="updateProduct(${idx}, 'cost', this.value)">
      售價: <input type="number" value="${p.price}" onchange="updateProduct(${idx}, 'price', this.value)">
      <button onclick="deleteProduct(${idx})">刪除商品</button>
    `;
    container.appendChild(div);
  });
}

function updateProduct(idx, field, value){
  products[idx][field] = parseFloat(value);
  renderBackend();
}

function deleteProduct(idx){
  if(confirm("確定刪除這個商品？")){
    const removed = products.splice(idx,1);
    renderBackend();
    if(selected.textContent === removed[0].name) selected.textContent = products[0].name;
  }
}

function addNewProduct(){
  const name = document.getElementById('newProductName').value.trim();
  const cost = parseFloat(document.getElementById('newProductCost').value);
  const price = parseFloat(document.getElementById('newProductPrice').value);
  if(!name || isNaN(cost) || isNaN(price)) return alert("請填完整商品資訊");
  products.push({name,cost,price});
  renderBackend();
  const opt = document.createElement('div'); opt.className='option'; opt.textContent=name;
  optionsContainer.appendChild(opt);
  opt.addEventListener('click',()=>{selected.textContent=name; optionsContainer.style.display='none';});
  document.getElementById('newProductName').value='';
  document.getElementById('newProductCost').value='';
  document.getElementById('newProductPrice').value='';
}

</script>
</body>
</html>
