<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>甜點記帳 (最終版)</title>
<style>
body {
  font-family: Arial; max-width:700px; margin:auto; padding:16px; background:#f2f2f7;
}
h2 { text-align:center; margin-bottom:16px; }

/* 區塊卡片 */
.form-card {
  background:#fff; border-radius:12px; padding:12px; margin-bottom:12px;
  box-shadow:0 1px 3px rgba(0,0,0,0.08),0 4px 12px rgba(0,0,0,0.06);
  font-size:1.4em;
}

/* 日期 / 份數 */
#dateInput, #qtyInput {
  font-size:1.2em; padding:6px; width:100%; box-sizing:border-box; text-align:center;
}

/* 假選單（商品） */
.custom-select {
  position: relative; font-size:1.2em; width:100%; background:#f2f2f7; border-radius:10px;
  border:1px solid #d1d1d6; cursor:pointer; box-sizing:border-box;
}
.custom-select .selected { padding:10px; text-align:center; }
.custom-select .options {
  display:none; position:absolute; top:100%; left:0; width:100%; background:#fff;
  border-radius:10px; border:1px solid #d1d1d6; max-height:200px; overflow-y:auto;
  z-index:100; box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
.custom-select .option { padding:10px; text-align:center; }
.custom-select .option:hover { background:#e5e5ea; }

/* 新增按鈕 */
#addBtn {
  font-size:1.2em; padding:10px; width:100%; border:none; border-radius:12px;
  background:#007aff; color:#fff; cursor:pointer;
}

/* 銷售表格 */
table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#f0f0f0; }
td:nth-child(3) { text-align:center; } /* 份數置中 */

/* 統計區塊 */
#totals { font-size:1.2em; padding:10px; background:#fff; border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-top:12px;
}

/* 後台密碼區塊 */
#backendWrapper { display:none; margin-top:12px; }
#backendWrapper input { font-size:1em; padding:4px; width:80px; margin-right:8px; }
#backendWrapper button { font-size:1em; padding:6px; border-radius:8px; background:#007aff; color:#fff; border:none; cursor:pointer; margin-top:4px; }

/* 後台商品管理 */
.backend-item { margin-bottom:12px; }
.backend-item div { margin-top:4px; }
</style>
</head>
<body>

<h2>甜點銷售記帳</h2>

<!-- 前台輸入區 -->
<div class="form-card">
  日期<br><input type="date" id="dateInput">
</div>

<div class="form-card">
  商品<br>
  <div class="custom-select" id="customProductSelect">
    <div class="selected">雞蛋糕</div>
    <div class="options"></div>
  </div>
</div>

<div class="form-card">
  份數<br><input type="number" id="qtyInput" min="1" value="1">
</div>

<div class="form-card">
  <button id="addBtn">新增</button>
</div>

<!-- 銷售表格 -->
<table id="salesTable">
  <thead>
    <tr>
      <th>日期</th>
      <th>商品</th>
      <th>份數</th>
      <th>成本</th>
      <th>售價</th>
      <th>收入</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 今日統計 -->
<div id="totals" class="form-card">
  <strong>今日總成本：</strong><span id="totalCost">0</span> 元<br>
  <strong>今日總收入：</strong><span id="totalRevenue">0</span> 元<br>
  <strong>今日總利潤：</strong><span id="totalProfit">0</span> 元
</div>

<!-- 後台密碼 -->
<div class="form-card">
  <input type="password" id="adminPassword" placeholder="輸入後台密碼">
  <button id="unlockBtn">進入後台</button>
</div>

<!-- 後台設定 -->
<div id="backendWrapper">
  <h3>後台商品管理</h3>
  <div id="backendItems"></div>
  <div class="backend-item">
    <input type="text" id="newProductName" placeholder="商品名稱">
    <input type="number" id="newProductCost" placeholder="成本">
    <input type="number" id="newProductPrice" placeholder="售價">
    <button id="addProductBtn">新增商品</button>
  </div>
</div>

<script>
// ===== 初始商品資料 =====
let products = JSON.parse(localStorage.getItem('products')) || [
  {name:'雞蛋糕', cost:20, price:50},
  {name:'奶酪杯', cost:25, price:60},
  {name:'提拉米蘇杯', cost:30, price:70},
  {name:'雪媚娘', cost:25, price:55},
  {name:'紅糖糍粑', cost:15, price:40},
  {name:'奶茶凍', cost:20, price:50},
  {name:'桂花奶酪', cost:25, price:60},
  {name:'華夫餅', cost:30, price:65}
];
let salesRecords = JSON.parse(localStorage.getItem('salesRecords')) || [];

// ===== 前台商品假選單 =====
const select = document.getElementById('customProductSelect');
const selected = select.querySelector('.selected');
const optionsContainer = select.querySelector('.options');

function updateProductOptions(){
  optionsContainer.innerHTML='';
  products.forEach(p=>{
    const div = document.createElement('div');
    div.className='option';
    div.textContent=p.name;
    div.addEventListener('click', ()=>{
      selected.textContent = p.name;
      optionsContainer.style.display='none';
    });
    optionsContainer.appendChild(div);
  });
}
updateProductOptions();

selected.addEventListener('click', ()=>{ optionsContainer.style.display = optionsContainer.style.display==='block' ? 'none':'block'; });
document.addEventListener('click', e=>{ if(!select.contains(e.target)) optionsContainer.style.display='none'; });

// ===== 新增銷售 =====
document.getElementById('addBtn').addEventListener('click', ()=>{
  const date = document.getElementById('dateInput').value;
  const productName = selected.textContent;
  const qty = parseInt(document.getElementById('qtyInput').value);
  if(!date||!productName||!qty){ alert("請填寫完整資訊！"); return; }
  const product = products.find(p=>p.name===productName);
  salesRecords.push({date, productName, qty, cost: product.cost, price: product.price});
  localStorage.setItem('salesRecords', JSON.stringify(salesRecords));
  renderSalesTable();
  document.getElementById('qtyInput').value=1;
  updateTotals();
});

// ===== 渲染銷售表格 =====
function renderSalesTable(){
  const tbody = document.querySelector('#salesTable tbody');
  tbody.innerHTML='';
  salesRecords.forEach((r,idx)=>{
    const d=new Date(r.date);
    const monthDay=`${d.getMonth()+1}/${d.getDate()}`;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${monthDay}</td><td>${r.productName}</td>
      <td style="text-align:center">${r.qty}</td>
      <td>${r.cost}</td>
      <td>${r.price}</td>
      <td>${r.qty*r.price}</td>
      <td><button onclick="deleteSale(${idx})">刪除</button></td>`;
    tbody.appendChild(tr);
  });
}

// ===== 刪除銷售 =====
function deleteSale(idx){
  if(confirm("確定刪除這筆銷售資料嗎？")){
    salesRecords.splice(idx,1);
    localStorage.setItem('salesRecords', JSON.stringify(salesRecords));
    renderSalesTable();
    updateTotals();
  }
}

// ===== 統計 =====
function updateTotals(){
  const today = document.getElementById('dateInput').value;
  let totalCost=0, totalRevenue=0;
  salesRecords.forEach(r=>{ if(r.date===today){ totalCost+=r.cost*r.qty; totalRevenue+=r.price*r.qty; }});
  document.getElementById('totalCost').textContent=totalCost;
  document.getElementById('totalRevenue').textContent=totalRevenue;
  document.getElementById('totalProfit').textContent=totalRevenue-totalCost;
}

// ===== 後台 =====
const correctPassword="1234";
document.getElementById('unlockBtn').addEventListener('click',()=>{
  const pwd=document.getElementById('adminPassword').value;
  if(pwd===correctPassword){ document.getElementById('backendWrapper').style.display='block'; document.getElementById('adminPassword').value=''; alert('後台已開啟'); renderBackend(); }
  else alert('密碼錯誤');
});

function renderBackend(){
  const container=document.getElementById('backendItems');
  container.innerHTML='';
  products.forEach((p,idx)=>{
    const div=document.createElement('div'); div.className='backend-item';
    div.innerHTML=`<div>${p.name}</div>
      <div>成本 <input type="number" value="${p.cost}" onchange="updateProduct(${idx},'cost',this.value)">
           售價 <input type="number" value="${p.price}" onchange="updateProduct(${idx},'price',this.value)"></div>
      <div><button onclick="deleteProduct(${idx})">刪除商品</button></div>`;
    container.appendChild(div);
  });
}

function updateProduct(idx,field,value){
  products[idx][field]=parseFloat(value);
  localStorage.setItem('products', JSON.stringify(products));
  updateProductOptions();
  renderSalesTable(); updateTotals(); renderBackend();
}

function deleteProduct(idx){
  if(confirm("確定刪除這個商品？")){
    products.splice(idx,1);
    localStorage.setItem('products', JSON.stringify(products));
    updateProductOptions();
    renderSalesTable(); updateTotals(); renderBackend();
  }
}

// ===== 新增商品 =====
document.getElementById('addProductBtn').addEventListener('click',()=>{
  const name=document.getElementById('newProductName').value.trim();
  const cost=parseFloat(document.getElementById('newProductCost').value);
  const price=parseFloat(document.getElementById('newProductPrice').value);
  if(!name||isNaN(cost)||isNaN(price)){ alert("請填寫完整商品資料"); return; }
  products.push({name,cost,price});
  localStorage.setItem('products', JSON.stringify(products));
  document.getElementById('newProductName').value=''; document.getElementById('newProductCost').value=''; document.getElementById('newProductPrice').value='';
  updateProductOptions(); renderBackend();
});

// ===== 初始化 =====
renderSalesTable(); updateTotals(); renderBackend();
</script>
</body>
</html>
